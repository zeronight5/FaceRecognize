<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIæµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        button.danger {
            background-color: #f44336;
        }
        button.danger:hover {
            background-color: #da190b;
        }
        pre {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background-color: #e8f5e9;
            border-left: 4px solid #4CAF50;
            border-radius: 4px;
        }
        .error {
            background-color: #ffebee;
            border-left-color: #f44336;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.online {
            background-color: #4CAF50;
            color: white;
        }
        .status.offline {
            background-color: #f44336;
            color: white;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ äººè„¸è¯†åˆ«APIæµ‹è¯•é¡µé¢</h1>
    
    <div class="section">
        <h2>1. å¥åº·æ£€æŸ¥</h2>
        <button onclick="testHealth()">æ£€æŸ¥æœåŠ¡çŠ¶æ€</button>
        <div id="healthResult"></div>
    </div>

    <div class="section">
        <h2>2. æŸ¥è¯¢äººè„¸åˆ—è¡¨</h2>
        <button onclick="testListAll()">æŸ¥è¯¢æ‰€æœ‰äººè„¸</button>
        <button onclick="testListByPersonId()">æŒ‰PersonIDæŸ¥è¯¢ (P001)</button>
        <button onclick="testListByName()">æŒ‰å§“åæŸ¥è¯¢ (å¼ ä¸‰)</button>
        <div id="listResult"></div>
    </div>

    <div class="section">
        <h2>3. APIç«¯ç‚¹å‚è€ƒ</h2>
        <pre>
<b>åŸºç¡€URL:</b> http://localhost:8080/api

<b>å¯ç”¨ç«¯ç‚¹:</b>
GET  /face/health                    - å¥åº·æ£€æŸ¥
POST /face/register/upload           - æ³¨å†Œäººè„¸ (æ–‡ä»¶ä¸Šä¼ )
POST /face/recognize/upload          - è¯†åˆ«äººè„¸ (æ–‡ä»¶ä¸Šä¼ )
GET  /face/list                      - æŸ¥è¯¢äººè„¸åˆ—è¡¨
     ?personId=xxx                   - æŒ‰personIdè¿‡æ»¤
     ?name=xxx                       - æŒ‰nameè¿‡æ»¤
     ?limit=100                      - é™åˆ¶è¿”å›æ•°é‡
GET  /face/person/{personId}         - æ ¹æ®personIdæŸ¥è¯¢
DELETE /face/{faceId}               - åˆ é™¤å•ä¸ªäººè„¸
DELETE /face/person/{personId}      - åˆ é™¤äººå‘˜æ‰€æœ‰äººè„¸
POST /face/reset                     - é‡ç½®æ•°æ®åº“
        </pre>
    </div>

    <div class="section">
        <h2>4. å±é™©æ“ä½œ</h2>
        <button class="danger" onclick="testReset()">âš ï¸ é‡ç½®æ•°æ®åº“</button>
        <div id="resetResult"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api';

        // æµ‹è¯•å¥åº·æ£€æŸ¥
        async function testHealth() {
            const resultDiv = document.getElementById('healthResult');
            resultDiv.innerHTML = '<p>æ­£åœ¨æ£€æŸ¥...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/face/health`);
                const data = await response.json();
                
                const statusClass = data.code === 200 ? 'online' : 'offline';
                resultDiv.innerHTML = `
                    <div class="result">
                        <p>çŠ¶æ€: <span class="status ${statusClass}">${data.code === 200 ? 'åœ¨çº¿' : 'ç¦»çº¿'}</span></p>
                        <p>æ¶ˆæ¯: ${data.message}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        <p>âŒ è¯·æ±‚å¤±è´¥: ${error.message}</p>
                        <p>è¯·ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨åœ¨ http://localhost:8080</p>
                    </div>
                `;
            }
        }

        // æµ‹è¯•æŸ¥è¯¢æ‰€æœ‰äººè„¸
        async function testListAll() {
            const resultDiv = document.getElementById('listResult');
            resultDiv.innerHTML = '<p>æ­£åœ¨æŸ¥è¯¢...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/face/list?limit=10`);
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="result">
                        <p>âœ… æŸ¥è¯¢æˆåŠŸ</p>
                        <p>æ‰¾åˆ° ${data.data ? data.data.length : 0} æ¡è®°å½•</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        <p>âŒ æŸ¥è¯¢å¤±è´¥: ${error.message}</p>
                    </div>
                `;
            }
        }

        // æµ‹è¯•æŒ‰personIdæŸ¥è¯¢
        async function testListByPersonId() {
            const resultDiv = document.getElementById('listResult');
            resultDiv.innerHTML = '<p>æ­£åœ¨æŸ¥è¯¢...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/face/person/P001`);
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="result">
                        <p>âœ… æŸ¥è¯¢æˆåŠŸ (personId=P001)</p>
                        <p>æ‰¾åˆ° ${data.data ? data.data.length : 0} æ¡è®°å½•</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        <p>âŒ æŸ¥è¯¢å¤±è´¥: ${error.message}</p>
                    </div>
                `;
            }
        }

        // æµ‹è¯•æŒ‰nameæŸ¥è¯¢
        async function testListByName() {
            const resultDiv = document.getElementById('listResult');
            resultDiv.innerHTML = '<p>æ­£åœ¨æŸ¥è¯¢...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/face/list?name=å¼ ä¸‰`);
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="result">
                        <p>âœ… æŸ¥è¯¢æˆåŠŸ (name=å¼ ä¸‰)</p>
                        <p>æ‰¾åˆ° ${data.data ? data.data.length : 0} æ¡è®°å½•</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        <p>âŒ æŸ¥è¯¢å¤±è´¥: ${error.message}</p>
                    </div>
                `;
            }
        }

        // æµ‹è¯•é‡ç½®æ•°æ®åº“
        async function testReset() {
            if (!confirm('âš ï¸ è­¦å‘Šï¼šæ­¤æ“ä½œå°†åˆ é™¤æ‰€æœ‰äººè„¸æ•°æ®ä¸”æ— æ³•æ¢å¤ï¼\n\nç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
                return;
            }
            
            const resultDiv = document.getElementById('resetResult');
            resultDiv.innerHTML = '<p>æ­£åœ¨é‡ç½®...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/face/reset`, {
                    method: 'POST'
                });
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="result">
                        <p>âœ… é‡ç½®æˆåŠŸ</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        <p>âŒ é‡ç½®å¤±è´¥: ${error.message}</p>
                    </div>
                `;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥å¥åº·çŠ¶æ€
        window.onload = function() {
            testHealth();
        };
    </script>
</body>
</html>
